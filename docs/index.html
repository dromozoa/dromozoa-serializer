<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>dromozoa-serializer</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/3.0.1/github-markdown.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.2/katex.min.css">
<style>
.markdown-body {
  box-sizing: border-box;
  min-width: 200px;
  max-width: 980px;
  margin: 0 auto;
  padding: 45px;
}
@media (max-width: 767px) {
  .markdown-body {
    padding: 15px;
  }
}
</style>
</head>
<body>
<div class="markdown-body">

<h1>dromozoa-serializer</h1>

<h2>リンク</h2>

<ul>
  <li>RFC
    <ul>
      <li><a href="https://www.ietf.org/rfc/rfc8259.txt">The JavaScript Object Notation (JSON) Data Interchange Format</a></li>
      <li><a href="https://www.ietf.org/rfc/rfc4180.txt">Common Format and MIME Type for Comma-Separated Values (CSV) Files</a></li>
    </ul>
  </li>
  <li><a href="https://www.unicode.org/Public/UCD/latest/ucd/">UCD</a></li>
  <li><a href="https://www.post.japanpost.jp/zipcode/download.html">郵便番号データダウンロード</a></li>
</ul>

<h2>TODO</h2>

<ul>
  <li>Cコードの実装</li>
</ul>

<h2>ベンチマーク対象データ</h2>

<ul>
  <li>UCD</li>
  <li>郵便番号</li>
  <li>正規表現から生成したDFA</li>
</ul>

<h2>v1形式</h2>

<h3>命令セット</h3>

<table>
  <tr>
    <th>code</th>
    <th>desc</th>
  </tr>
  <tr>
    <td><code>1 ref</code></td>
    <td>Lookup</td>
  </tr>
  <tr>
    <td><code>2 data</code></td>
    <td>Integer (int64_t)</td>
  </tr>
  <tr>
    <td><code>3 data</code></td>
    <td>Number (double)</td>
  </tr>
  <tr>
    <td><code>4 size:data</code></td>
    <td>String (instant)</td>
  </tr>
  <tr>
    <td><code>5 ref size:data</code></td>
    <td>String (dictionary)</td>
  </tr>
  <tr>
    <td><code>6 ref size</code></td>
    <td>Table</td>
  </tr>
  <tr>
    <td><code>7 0</code></td>
    <td>End</td>
  </tr>
</table>

<h3>初期辞書</h3>

<table>
  <tr>
    <th>code</th>
    <th>value</th>
  </tr>
  <tr>
    <td>0</td>
    <td><code>nil</code></td>
  </tr>
  <tr>
    <td>1</td>
    <td><code>true</code></td>
  </tr>
  <tr>
    <td>2</td>
    <td><code>false</code></td>
  </tr>
</table>

<h2>v2形式</h2>

<h3>命令セット</h3>

<pre>
opi
  lookup
  string
  table

op
  lookup
  string
  table
  end
  integer
  number

lookupとtableはあらかじめエンコードしておける

  0 0x0000 .. 0x3FFF  lookup
 64 0x4000 .. 0x7FFF  string
128 0x8000 .. 0xBFFF  table
192 0xC000            table

0xFF 0x01 lookup
0xFF 0x02 string
0xFF 0x03 integer
0xFF 0x04 number
0xFF 0x05 end
</pre>

<pre>
u8
 1 ref:u8                           lookup
 2 size:u8 ref:string  " "          lookup
 3 size:u8 data:string " "          integer
 4 size:u8 data:string " "          number
 5 size:u8 data:string              string (instant)
 6 size:u8 size:string data:string  string (instant)
 7 ref:u8                           table
 8 size:u8 ref:string " "           table
 9 0                                end
</pre>

</div>
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.2/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.2/contrib/auto-render.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  renderMathInElement(document.body);
});
</script>
</body>
</html>
