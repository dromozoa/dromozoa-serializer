<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>dromozoa-serializer</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/3.0.1/github-markdown.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.2/katex.min.css">
<style>
.markdown-body {
  box-sizing: border-box;
  min-width: 200px;
  max-width: 980px;
  margin: 0 auto;
  padding: 45px;
}
@media (max-width: 767px) {
  .markdown-body {
    padding: 15px;
  }
}
</style>
</head>
<body>
<div class="markdown-body">

<h1>dromozoa-serializer</h1>

<h2>リンク</h2>

<ul>
  <li>RFC
    <ul>
      <li><a href="https://www.ietf.org/rfc/rfc8259.txt">The JavaScript Object Notation (JSON) Data Interchange Format</a></li>
      <li><a href="https://www.ietf.org/rfc/rfc4180.txt">Common Format and MIME Type for Comma-Separated Values (CSV) Files</a></li>
    </ul>
  </li>
  <li><a href="https://www.unicode.org/Public/UCD/latest/ucd/">UCD</a></li>
  <li><a href="https://www.post.japanpost.jp/zipcode/download.html">郵便番号データダウンロード</a></li>
</ul>

<h2>TODO</h2>

<ul>
  <li>新しい形式の策定
    <ul>
      <li>命令コードとオペランドを合併する</li>
      <li>バイナリ形式</li>
    </ul>
  </li>
  <li>メモリIO</li>
  <li>Luaコード生成</li>
  <li>Cコードの実装</li>
</ul>

<h2>ベンチマーク対象データ</h2>

<ul>
  <li>UCD</li>
  <li>郵便番号</li>
  <li>正規表現から生成したDFA</li>
</ul>

<h2>v1形式</h2>

<h3>命令セット</h3>

<table>
  <tr>
    <th>code</th>
    <th>desc</th>
  </tr>
  <tr>
    <td><code>1 ref</code></td>
    <td>Lookup</td>
  </tr>
  <tr>
    <td><code>2 data</code></td>
    <td>Integer (int64_t)</td>
  </tr>
  <tr>
    <td><code>3 data</code></td>
    <td>Number (double)</td>
  </tr>
  <tr>
    <td><code>4 size:data</code></td>
    <td>String (instant)</td>
  </tr>
  <tr>
    <td><code>5 ref size:data</code></td>
    <td>String (dictionary)</td>
  </tr>
  <tr>
    <td><code>6 ref size</code></td>
    <td>Table</td>
  </tr>
  <tr>
    <td><code>7 0</code></td>
    <td>End</td>
  </tr>
</table>

<h3>初期辞書</h3>

<table>
  <tr>
    <th>code</th>
    <th>value</th>
  </tr>
  <tr>
    <td>0</td>
    <td><code>nil</code></td>
  </tr>
  <tr>
    <td>1</td>
    <td><code>true</code></td>
  </tr>
  <tr>
    <td>2</td>
    <td><code>false</code></td>
  </tr>
</table>

<h2>v2形式</h2>

<table>
  <tr>
    <th>code</th>
    <th>constraint</th>
    <th>desc</th>
  </tr>
  <tr>
    <td><code>ref</code></td>
    <td>\[0 \le \rm{ref} \lt 2^{48}\]</td>
    <td>Lookup</td>
  </tr>
  <tr>
    <td><code>0x1800000000000+data</code></td>
    <td>\[-2^{47} \le \rm{data} \lt 2^{47}\]</td>
    <td>Small Integer (int48_t)</td>
  </tr>
  <tr>
    <td><code>-1 data</code></td>
    <td></td>
    <td>Large Integer (int64_t)</td>
  </tr>
  <tr>
    <td><code>0x2800000000000+data</code></td>
    <td>
      \[-2^{47} \le \rm{data} \lt 2^{47}\]<br>
      <code>data</code>は整数表現可能。
    </td>
    <td>Small Number (int48_t)</td>
  </tr>
  <tr>
    <td><code>-2 data</code></td>
    <td></td>
    <td>Number (double)</td>
  </tr>
  <tr>
    <td><code>0x3000000000000+size : data</code></td>
    <td>\[0 \le \rm{size} \lt 2^{48}\]</td>
    <td>String (instant)</td>
  </tr>
  <tr>
    <td><code>0x4000000000000+ref*0x1000000+size : data</code></td>
    <td>
      \[\begin{aligned}
        0 &amp;\le \rm{ref} \lt 2^{24} \\
        0 &amp;\le \rm{size} \lt 2^{24} \\
      \end{aligned}\]
    </td>
    <td>Small String (dictionary)</td>
  </tr>
  <tr>
    <td><code>-3 ref size</code></td>
    <td></td>
    <td>Large String (dictionary)</td>
  </tr>
  <tr>
    <td><code>0x5000000000000+ref*0x1000000+size : data</code></td>
    <td>
      \[\begin{aligned}
        0 &amp;\le \rm{ref} \lt 2^{24} \\
        0 &amp;\le \rm{size} \lt 2^{24} \\
      \end{aligned}\]
    </td>
    <td>Small Table</td>
  </tr>
  <tr>
    <td><code>-4 ref size</code></td>
    <td></td>
    <td>Large Table</td>
  </tr>
  <tr>
    <td><code>-5</code></td>
    <td></td>
    <td>End</td>
  </tr>
</table>

</div>
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.2/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.2/contrib/auto-render.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  renderMathInElement(document.body);
});
</script>
</body>
</html>
